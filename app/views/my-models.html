

<div class="h2">My Models</div>
<hr class="no-margin">


<div ng-if="data.length">
    <div class="table-controls">
        <div layout="row" layout-align="start start" class="pull-left">
            <i class="fa fa-search query-opt"></i>

            <md-input-container md-no-float>
                <input ng-model="opts.query" type="text" placeholder="Search models" class="query-input">
            </md-input-container>

            <md-progress-circular ng-if="loading"
                                  md-mode="indeterminate"
                                  class="pull-left"
                                  md-diameter="20">
            </md-progress-circular>
        </div>


        <div class="pull-right">
            <span pagination>
                <div ng-disabled="opts.offset == 0"
                     class="btn btn-default btn-sm" ng-click="prev()">
                    <i class="fa fa-chevron-left"></i> prev
                </div>
                <div ng-disabled="opts.offset+opts.limit > filtered.length"
                     class="btn btn-default btn-sm" ng-click="next()">next
                    <i class="fa fa-chevron-right"></i>
                </div>
            </span>
        </div>

        <div class="pull-right query-opt">
            {{opts.offset+1}}-{{opts.offset + opts.limit}} of {{filtered.length}} models
        </div>
    </div>

    <br>
    <br>

    <div layout="row"
        ng-repeat-start="item in (filtered = ( data | filter: opts.query
                                                  | orderBy : opts.sort.field : opts.sort.desc)
                                                  | limitTo : opts.limit : opts.offset) | orderBy : '-timestamp' track by $index"
        ng-click="showFBAs(item)"
        class="table-hover my-model">


        <div class="expand-container vertical-center">
            <md-tooltip md-direction="left" md-delay="1000" md-autohide="true">
                {{!item.relatedFBAs ? 'Click row to view FBA and Gapfills' : 'Click row to hide FBA and Gapfills'}}
            </md-tooltip>
            <i ng-if="!item.loading && !item.relatedFBAs"
               class="fa fa-caret-right"
               style="opacity: 0.5;"></i>
            <i ng-if="item.relatedFBAs"
               class="fa fa-caret-down"
               style="opacity: 1.0;"></i>

            <img ng-if="item.loading"
                 src="img/ajax-loader.gif"
                 width="15" height="15">
            </img>
        </div>

        <div flex="35" class="vertical-center">
            {{item.orgName}}<br>
            <a ui-sref="app.modelPage({path: item.path})">
                <md-tooltip  md-delay="800">View Model</md-tooltip>
                {{item.name}}
            </a>
        </div>

        <div flex class="vertical-center">
            <md-button md-no-ink ng-click="runFBA($event, item)">
                <i class="fa fa-code-fork"></i>
                Run FBA
            </md-button><br>
            <md-button md-no-ink ng-click="gapfill($event, item)">
                <i class="fa fa-circle"></i>
                Gapfill
            </md-button>
        </div>


        <div flex="15" class="vertical-center" style="text-align: left;">
            <span class="badge label-fba">
                <md-tooltip>Number of FBAs</md-tooltip>
                {{item.fbaCount}}
            </span>
            <span class="badge label-gapfill">
                <md-tooltip>Number of Gapfill Solutions</md-tooltip>
                {{item.gapfillCount}}
            </span><br>
            <small><b>{{item.rxnCount}}</b> Compounds</small>
            <br>
            <small><b>{{item.cpdCount}}</b> Reactions</small>
        </div>


        <div flex class="timestamp">
            <small>{{relativeTime(item.timestamp)}}</small>
        </div>

        <div flex="5" class="vertical-center" style="text-align: right;">
            <md-button md-no-ink class="pull-right" ng-click="rmModel($event, $index, item)" aria-label="delete model">
                <md-tooltip md-direction="left" ng-if="!selected">Delete model</md-tooltip>
                <i class="icon-highlight-remove"></i>
            </md-button>
            <br>
            <md-button md-no-ink ng-click="toggleOperations($event, 'download', item)" aria-label="view download options">
                <md-tooltip md-direction="left" ng-if="!selected">View download options</md-tooltip>
                <i class="icon-file-download"></i>
            </md-button>
        </div>
    </div>

    <div ng-if="item.relatedFBAs || item.relatedGapfills" ng-repeat-end class="my-models-tabs">
        <md-tabs md-selected="tabs.selectedIndex" md-no-ink md-dynamic-height="false">
            <md-tab label="FBA Simulations ({{item.fbaCount}})">
                <md-tab-body>
                    <ng-include src="'app/views/lists/expanded-fbas.html'">
                </md-tab-body>
            </md-tab>

            <md-tab label="Gapfills ({{item.gapfillCount}})">
                <md-tab-body>
                    <ng-include src="'app/views/lists/expanded-gapfills.html'">
                </md-tab-body>
            </md-tab>
        </md-tab>
    </div>



    <section ng-controller="SideNav">
        <md-sidenav  class="md-sidenav-right md-whiteframe-z2" md-component-id="downloadOpts">
            <md-toolbar class="md-theme-light">
                <h1 class="md-toolbar-tools">Download</h1>
            </md-toolbar>
            <md-content layout-padding layout="column" layout-align="center center">

                <md-button class="md-grid-item-content" href="{{selected.downloadURL}}">
                    <b class="fa-2x">{}</b>
                    <div> JSON </div>
                </md-button>

                <md-button class="md-grid-item-content"> <!-- ng-click="prepareDownload($event, selected)"-->
                    <md-progress-circular ng-if="loadingSBML"
                                          md-mode="indeterminate"
                                          md-diameter="20">
                    </md-progress-circular>
                    <img src="img/sbml-logo-32.png" height="20">
                    <div>SBML<br>(coming soon)</div>
                </md-button>

                <md-button ng-click="close()" class="md-primary">
                    Close
                </md-button>
            </md-content>
        </md-sidenav>

    </section>
</div>

<md-progress-circular ng-if="loading"
                      md-mode="indeterminate"
                      class="pull-left"
                      md-diameter="40">
</md-progress-circular>

<div ng-if="data && !data.length">
    <br>
    You have no models.  Consider <a ui-sref="app.reconstruct">resconstructing a model</a>.
</div>
